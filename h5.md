## h5 It's Alive!

### alustus
Tehtävät tehdään oracle virtualboxin linux debian virtuaalikoneella johon siirsin tehtävän tiedostot ssh yhteyden avulla. 

### Lab 0

#### ssh
Aloitin ssh yhteyden luomisesta ja tiedostojen siirtämisestä isäntäkoneelta virtuaalikoneelle, koska en virtuaalikoneella halua kirjautua moodleen tai mihinkään muuhunkaan palveluun.
En hirveemmin ole aiemmin ollut tarvetta ssh yhteydelle, joten lähdin selvittämään kuinka se toimii. Tähän tutustuin alkuun [tämän](https://dev.to/developertharun/easy-way-to-ssh-into-virtualbox-machine-any-os-just-x-steps-5d9i)
ohjeen avulla, tämä ei kuitenkaan tuonut kaikkia vastauksia kysymyksiini esimerkiksi ssh serverin asennukseen ja käynnistykseen liittyen. Sain lisättyä uuden NAT tyyppisen network adapterin josta alla kuva. 

<img width="1164" height="772" alt="image" src="https://github.com/user-attachments/assets/fdfb7e2c-2f93-48ee-aaec-d4534cc86bd3" />

Sain paljon apua [tästä](https://wiki.debian.org/SSH) ohjeesta jolla sain asennettua serverin virtuaalikoneelleni. 
[tämän](https://linuxgenie.net/how-to-configure-and-enable-ssh-on-debian-12/) ohjeen avulla sain käynnistettyä serverin ja testailtua onko se käynnissä. 

<img width="820" height="316" alt="image" src="https://github.com/user-attachments/assets/2b7e476a-4e5e-4892-96e4-d3910823d130" />

SSH serveri käynnissä joten yhteyden pitäisi muodostua helposti, vai? No ei kuitenkaan, kun koitin yhdistää virtuaalikoneeni ssh palvelimelle, sain virheen:

```bash
C:\Windows\System32>ssh -p 3022 jani@127.0.0.1
kex_exchange_identification: read: Connection reset
Connection reset by 127.0.0.1 port 3022
```

Hetken tekoälyn kanssa ihmetellessä virhettä, löysin virheen [tämän videon](https://www.youtube.com/watch?v=YjraMLioCUE) avulla kohdasta 2:35 jossa piti sallia liikenne portille 22 komennolla: 
```bash
sudo ufw allow 22/tcp
```
Tämän jälkeen sain siirrettyä lataamani .zip -tiedoston virtuaalikoneelleni alla olevalla komennolla jonka jälkeen syötin virtuaalikoneen salasanan. 

```bash
$ scp -P 3022 ./Dynaaminen\ analyysi-20260219.zip jani@127.0.0.1:/home/jani/hakkerointi
```
Tämän jälkeen pääsin tekemään itse tehtävää virtuaalikoneellani. 

kesto: 2h

#### tehtävä
Aloitin ihan alkuun katsomalla [tämän](https://www.youtube.com/watch?v=Tmdnsre9z7s) videon liittyen gnu debuggeriin ja sen ominaisuuksiin.
Tämän jälkeen uzippasin koko dynaamisen lähdekoodi -kansion joka sisälsi kaikki lab tehtävät ja pdf tiedostot. Unzippasin lab0 tehtävän ja lueskelin pdf tiedostoa liittyen gnu debuggeriin joka toimitettiin dynaamisen lähdekoodin zip tiedostossa. Ajoin lab0 bugista lähdekoodia gdb ./buggy_program -komennon avulla jonka jälkeen aloin tutustumaan olemassa oleviin gdb komentoihin [tämän](https://www.geeksforgeeks.org/c/gdb-step-by-step-introduction/) lähteen avulla. 

Asetin breakpointeja main funktioon sekä buggy_funktioon layout asm näkymässä olevien funktionimien mukaisesti. Tämän jälkeen ajoin run komennon joka käynnisti sovelluksen. Continuen avulla siirryin funktioiden ajoon ja stepillä kävin bugisen for loop funktion läpi ja tulostin i arvoa ja arr[i] arvoa todetakseni että annettu taulukko on pienempi mitä for loop on pituudeltaan, josta bugi muodostuu. Nämä selitykset näkyivät myös l komentoa käytettäessä kun näin lähdekoodia. 

<img width="954" height="853" alt="image" src="https://github.com/user-attachments/assets/8040fb9a-5a85-4707-a0f1-4bd73711649d" />

### lab1
#### tehtävä
Unzippasin lab1 tiedoston ja siirryin kansioon ja ajoin gdb ./gdb_example1 . Tämän jälkeen ajoin run joka ajoi ohjelmaa ja ruudulle tulostui: 

```bash
Program received signal SIGSEGV, Segmentation fault.
0x000055555555514f in print_scrambled (message=0x0) at gdb_example1.c:7
7	    printf("%c", (*message)+i);
```
Tästä voitaisiin kait päätellä että virhe tapahtuu lähdekoodissa rivillä 7. 

Asetan muutaman breakpointin layout asm mukaan main+34 ja main+46 joissa print_scrambled funktiota ajetaan kahdella eri syötteellä. Tämän mukaan ohjelma kaatuu toisen syötteen kohdalla joka on NULL arvoinen. Tästä voin alkuun todeta että jotain tekemistä null arvolla on asian suhteen. Laitan kolmannen breakpointin koodiriville 7 jotta näen tulostettavan arvon aina. Tulosteiden mukaan voidaan päätellä ilman c -kielen osaamista että on kyseesä jonkin sortin looppi jossa koko annettu merkkijono tulostetaan aina edeten yhden merkin eteenpäin. 

<img width="934" height="850" alt="image" src="https://github.com/user-attachments/assets/fc5e038c-20b7-4b01-8c09-28214f52187e" />

Tämän perusteella voin vahvistaa havaintoni että sovellus kaatuu kun koittaa tulostaa osoitinta käyttämällä merkkijonon. Lisäämällä jonkun tarkistuksen NULL arvoille, tämä virhe voidaan välttää.

kesto: 1h

### lab2
#### tehtävä
Aiemman kaavan mukaan unzippasin tiedostot ja ajoin passtr tiedoston debuggerissa. Ajoin run ja antoi "What's the password:" tekstin johon laitoin test, antoi "sorry, no bonus". Annoin layout asm komennon jolla aloin asettamaan break pointeja koodiin. Asetin breakpointin main funktioon jossa sijaitsee funktio jonka avulla vertaillaan kahta merkkijonoa keskenään. list komennolla pääsi näkemään lähdekoodia jossa sijaitsi if ehto jossa kovakoodattuna salasana. 

En ollut varma miten pystyn ilman lähdekoodia tutkailemalla tulostamaan print komennolla kovakoodatun arvon, tiesin kyllä että muuttujia pystyy listaamaan ja tulostamaan print komennolla. Loppujen lopuksi sala-hakkeri-321 kävi salasanaksi. Ajoin tiedostoa tutkiessa muuttujia ja niiden arvoja kääntämällä ensiksi lähdekoodin komennolla: 

> gcc passtr.c -g -Wall -Werror -o passtr-dbg

Tämän jälkeen tutkailin ja asettelin breakpointeja sinne tänne ja koitin etsiä muuttujia ja tulostella niitä. Eli testailin debuggerin ominaisuuksia vaikka olin löytänyt flagin.

<img width="955" height="815" alt="image" src="https://github.com/user-attachments/assets/d40505f9-8c40-45e0-ba29-205f2ab46960" />

<img width="889" height="323" alt="image" src="https://github.com/user-attachments/assets/254a18fb-8039-4209-8472-81cc60d49a39" />

kesto: 4h

### lab3

Tämä tehtävä oli ilmeisesti vapaaehtoinen moodlen mukaan.

<img width="856" height="253" alt="image" src="https://github.com/user-attachments/assets/acce1f72-1309-4119-91e3-87e60e2b0627" />


### crackme03

Jatkoin tutustumista gnu debuggerin toimintoihin lähdekoodiin tukeutuen (komento l). Käänsin lähdekoodin tehtävään crackme03 komennolla gcc crackme03 -g -o 03-gbd jonka jälkeen ajoin sovelluksen gdb ./03-gdb. Tämän jälkeen syötin l komennon jolla näin lähdekoodia crackme03.c tiedostosta. Asetin break pointeja valitsemiini paikkoihin joissa koin koodin tekevän tarkastuksia antamaani syötteeseen sovelluksen ajon yhteydessä. 

<img width="942" height="799" alt="image" src="https://github.com/user-attachments/assets/102d8669-72c6-4527-8363-18bb780683f9" />

<img width="943" height="651" alt="image" src="https://github.com/user-attachments/assets/4b64d729-c3eb-4e09-aa7d-d93fe5689f10" />

Koin selkeitä "ahaa" elämyksiä kun tajusin kuinka lokaleiden listaus tapahtuu ja sain nähtyä muuttujat ja niiden sisältämät arvot, vaikkakin olin käyttänyt samoja komentoja aikasemminkin. Lisäksi kun luin ohjeita niin pystyin main funktion ulkopuolisia funktioita ajamaan omilla muuttujien arvoilla komennolla:

> set password = "test"
> set correct = "aaaaaa"
> set mask = {1,1,1,1,1}

Tämä asettaa funktiolla annettavan salasanan joka mallintaa käyttäjän antamaa syötettyä salasanaa, joka on tässä tapauksessa "test" merkkijono. Samoin syötetään "oikea" salasana ja maski joka on lista numeroita.

Tämä toimi toistaiseksi hyvin, mutta kun if ehtolausekkeessa jos masked_char ei ole sama kuin salasanan vastaavan järjestyksen (i) merkki, loop päättyy ja palautetaan 1 ja palataan main funktioon. Muokkasin syöttämällä password = bbbbba", correct = "aaaaaa", mask = {1,1,1,1,1,1} jolloin loopin pitäisi epäonnistua viimeisen merkin kohdalla. Jostain syystä loop kuitenkin minun havaintojen mukaan katkeaa toisen merkin kohdalla, voin olla myös väärässä.

Jatkoin tutkimista ja tulostin jokaisessa loopin vaiheessa jokaista muuttujaa, i, mask ja masked_char. Huomasin että mask sisältää vain yhden numeron vaikka olin alustanut mielestäni useamman numeron. 

<img width="569" height="225" alt="image" src="https://github.com/user-attachments/assets/3e22da72-9fc7-43bd-8906-2ad8b0e7af99" />

Koitin asettaa numerotaulukolle jokaiselle paikalle erikseen numeron, joka toimi. Olin aluksi alustanut muuttujan mask väärin, jonka vuoksi loop kaatui toisen mask numeron ollessa 0 ja salasanojen vertailun mennessä väärin. Nyt se käy jokaisen merkin oikein läpi ja vertailee maskin kanssa salasanojen merkkejä keskenään. 

Lopputulemana: Annettua salasanaa verrataan kovakoodatun salasanan kanssa jonka jokainen merkki muutetaan maskin avulla toiseksi merkiksi. Oikea salasana paljastetaan lähdekoodin kommentissa, mutta tämän saisi selvitettyä syöttämällä testiparametrejä salasanan tarkastavalle funktiolle ja tulostamalla lopputulosta print komennolla.  

<img width="935" height="787" alt="image" src="https://github.com/user-attachments/assets/5eb2ea6e-08a2-49f8-9767-0bf6251a2271" />


## Lähteet
- https://www.geeksforgeeks.org/c/gdb-step-by-step-introduction/
- https://dev.to/developertharun/easy-way-to-ssh-into-virtualbox-machine-any-os-just-x-steps-5d9i
- https://wiki.debian.org/SSH
- https://linuxgenie.net/how-to-configure-and-enable-ssh-on-debian-12/
- https://www.youtube.com/watch?v=YjraMLioCUE

