# Hardware Hacking

## Johdanto & alustus

### Johdando
Rehellisesti sanottuna, tehtävänannon lukeminen itsessään ja ongelmat tehtävän alkuvaiheessa liittyen decrypterin skriptien ajamiseen linux debian ympäristössä,
antoivat huonon alkusoiton koko viikkotehtävälle. Tähän lisätäkseni surkeat tehtävänannot/kuvaukset ja omaan taitotasoon nähden tehtävä joka on huomattavasti vaikeampi aikaisempiin verrattuna.
Alla kuvausta 6h sessiosta ilman päämäärää joka on muodostettu sanoiksi.

### Alustus

Aloitin asentamalla tunnilla https://download.tplinkcloud.com/firmware/Tapo_C200v3_en_1.4.2_Build_250313_Rel.40499n_up_boot-signed_1747894968535.bin ja https://github.com/robbins/tp-link-decrypt
firmwaren ja decryptaajan binäärille. Tunnilla käytiin muutamia komentoja ja erroria tuli huomattava määrä jota Larin johdolla sitten selviteltiin asentelemalla debianista puuttuvat paketit.
Kotona asentelin vielä pythonille jefferssonin jolloin ajoin decrypterin README.md tiedoston mukaan tarvittavat .sh tiedostot. 

## Tehtävät

Moodlessa oli annettu tehtävänannot: 

1. decrypt firmware image
2. Analyse the image file
3. extract rootfs from the dump file
4. extract rootfs from the image file
5. search available applications
6. analyse and try to open root password

## 1. decrypt firmware imgage

Syötin binäärin decrypterille, joka oletetusti toimi, koska näin nyt binäärin sisällön joka aiemmin oli salattuna kun ajoin binwalk -komentoa.

<img width="804" height="58" alt="image" src="https://github.com/user-attachments/assets/6be03881-b006-499c-a6ab-21e4256b35ee" />

## 2. Analyse the image file

Tässä tuliki seuraavia pulmia koska pelkkää binwalkia ajaessa se näytti xz kompressoituja rivejä ja gzip kompressoitua dataa, Tutustuin eri lähteiden avulla xz, dd -komentoon jolla ilmeisesti pilkotaan tiedostoa, unsquashfs -komentoihin ja 
binwalkin komentoihin. Tämä tapahtui joskus komentokehotteessa -h ja --h komentojen avulla, riippuen paketista, joskus selaamalla selainta liittyen kyseisiin työkaluihin. Työkalut olivat ymmärrettäviä ja osittain tuli valon pilkahduksia
kun oppi jotain uutta, vaikkakin oli tehtävänannon ulkopuolisia asioita. Pilkoin dd avulla katsoen binwalkista halutusta kohdasta uuden tiedoston, jonka nimesin kernel.xz. 

<img width="799" height="93" alt="image" src="https://github.com/user-attachments/assets/e5796424-6c47-4f6c-ab8f-94452a487c01" />

Kun koitin ajaa xz -d komentoa tiedostolle, sanoi että tiedosto on korruptoitunut, en tiedä johtuuko salauksesta. Syötin tiedoston https://emn178.github.io/online-tools/sha256_checksum.html joka antoi kyseisen outputin jos tästä
olisi myöhemmälle vaiheelle käyttöä.

<img width="1912" height="841" alt="image" src="https://github.com/user-attachments/assets/b5a88621-23f2-42e5-a46d-571e56c2caa8" />

Tuntien ihmettelyn jälkeen, päätin ajaa binwalk -e jonka jälkeen tuli seuraava kansio näkyviin: 

> _Tapo_C200v4_en_1.4.2_Build_250723_Rel.66773n_up_boot-signed_1754482060073.bin.dec.extracted

Avasin kansion ja pääsin seuraavaan tehtävään

kesto:4h

## 2. Analyze the image file

Tämä olikin ihan päämäärätöntä sekoilua alusta asti, koitin ihmetellä että mistä löytyisi rootin salasana ja käyttäjätunnus ja välillä en ees tienny mitä etsin. Käynnistin squashfs-root kansiosta erinäisiä tiedostoja ghidralla ja koitin selailla
sen stringsin avulla merkkijonoja: pw, password, root jne. ,mutta funktioita oli niin paljon ja kaikki sekalaista c-kielen moskaa josta ymmärrä mitään. Kävin hajanaisesti erilaisia konfigurointi tiedostoja file -komennon avulla läpi ja availin kaikki elf -muotoiset
ghidrassa. Tämä kaikki tuloksetta. Alla vielä kuva kansion sisällöstä:

<img width="1908" height="549" alt="image" src="https://github.com/user-attachments/assets/2fb70bdd-2105-4980-9d87-c523121d629b" />

kesto: 6h

## Lopputulema & ajatukset

Tunnilla taisi olla mainintaa dekryptaajan korjaamisesta ennen tehtäviä, ellen väärin muista. Tätä ei kuitenkaan ollut moodlessa mainittu joten kotona en tajunnut korjata sitä, enkä varmaan olisi osannutkaan. 
Ehkä päällimmäisenä ajatuksena olisi että xz kompressoidut tiedostot jotka on salattu sha256 tavalla, olisi hyvä saada auki?


Koen että oma osaamattomuus ilmeisesti koitui tämän tehtävän osalta kohtalokseni, koska kohdan 2. jälkeen ei ollut mitään suuntaa mitä tekisi seuraavaksi. Tästä voi EHKÄ syyttää suppeaa tehtävänantoa, joka oli huomattavasti alkeellisempi kuin aikaisempien viikkojen, 
sisältämättä (yhtä linkkiä lukuunottamatta) helpotuksia tehtävään tai umpikujiin liittyen tai edes työkaluihin linkkejä.
Tekoälyltä kyselin pääsääntöisesti dd, xz, squashfs liittyen, mutta pääsääntöinen tiedonlähden oli selain ja -h komennot paketeille. En kokenut jatkuvaa promptaamista tarpeelliseksi kun kurssin tavoite on kaiketi oppia asioita eikä promptaamalla tehdä tehtävät valmiiksi. 


Tehtävän tekoon käytetty kolmen päivän aikana yhteensä 12h josta 2h dokumentaation tekemistä.

## Lähteet

- https://linuxconfig.org/how-to-extract-xz-compressed-archive-on-linux
- https://fr3ak-hacks.medium.com/analysing-and-extracting-firmware-using-binwalk-982012281ff6
- https://reverseengineering.stackexchange.com/questions/20127/unable-to-unsquash-from-a-firmware-dump
- https://www.hardbreak.wiki/hardware-hacking/analyze-firmware

sekä liuta stack overflow linkkejä joita en luettele.


